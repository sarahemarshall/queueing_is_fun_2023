---
title: "Designing a new supermarket"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---



```{r, echo = FALSE, results = "hide"}
###########################################
#### EDIT NUMBERS IN THIS SECTION #########
###########################################
num_servers_selfcheckout = 0   # number of checkout operators
num_servers_staffed = 7        # number of checkout operators > 0

simulation_length = 1000  # number of minutes
###########################################
```





```{r, echo = FALSE, results = "hide"}
lambda_express = 4               # number of customers arriving per minute
lambda_regular = 1              # number of customers arriving per minute

average_service_time_express = 1 # number of minutes
average_service_time_regular = 5 # number of minutes

mu_express = 1/average_service_time_express
mu_regular = 1/average_service_time_regular

cost = 10*num_servers_selfcheckout + 100*num_servers_staffed
#policy = "shortest-queue"
policy = "random"

```




```{r setup, include=FALSE, message = FALSE}
packages_needed <- c("tidyverse", "flexdashboard", 
                     "simmer","simmer.plot",
                     "plotrix", "grDevices", 
                     "kableExtra")

packages_to_install <- packages_needed[!packages_needed %in%
                                         installed.packages()]
sapply(packages_to_install, install.packages,
       dependencies=TRUE, repos="https://cloud.r-project.org")
sapply(packages_needed, require, character=TRUE)

knitr::opts_chunk$set(echo = FALSE, 
                      results = "hide", 
                      message = FALSE)


show_theory = FALSE

source("Code/queueing_functions.R")
```


Column {data-width=400}
-----------------------------------------------------------------------
### **Summary of parameters**



* Number of self-checkouts = `r num_servers_selfcheckout`  
* Number of staffed-checkouts = `r num_servers_staffed`
* Express Customers Arrival rate, $\lambda$ = `r lambda_express` per minute
* Express Customers Service rate, $\mu$ = `r mu_express` per minute
* Regular Customers Arrival rate, $\lambda$ = `r lambda_regular` per minute
* Regular Customers Service rate, $\mu$ = `r mu_regular` per minute


### **Queue Layout: **  `r paste0("Cost: $", cost)`

```{r, fig.dim = c(7, 8)}
par(mfrow = c(1,1))
if(num_servers_selfcheckout>0){
  par(mfrow = c(2,1))
  plot_queue_layout(num_servers_selfcheckout, type_of_queue="one_line")
}
plot_queue_layout(num_servers_staffed, type_of_queue = "individual_lines")
 
```


 
```{r, echo = FALSE, results = "hide"}
# Run simulation
mmc.env <- run_simulation_checkouts(lambda_express,
                                    lambda_regular,
                                    mu_express,
                                    mu_regular,
                                    num_servers_selfcheckout,
                                    num_servers_staffed,
                                    simulation_length,
                                    policy = policy)

```


### **Queue Performance**
```{r, results = "asis"}
 options(knitr.kable.NA = '')
q <- plot_number_in_queue(mmc.env, num_per_row=4)
q <- get_performance_checkouts(mmc.env, q)

print_table_checkouts(q, include_theory = FALSE, comparison= c(average_service_time_express, average_service_time_regular, NA))
```



Column {data-width=600}
-----------------------------------------------------------------------
### **Number in the queue**

```{r, fig.dim = c(12, 12)}
q$graph

```



